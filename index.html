<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Emissor de Faturas - Lux Café</title>

<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .invoice { max-width: 900px; margin: auto; padding: 20px; border: 1px solid #ccc; }
    h1 { text-align: center; }

    .logo {
        width: 220px;
        display: block;
        margin: 0 auto 20px auto;
    }

    label { display: block; margin-top: 10px; font-weight: bold; }
    input, textarea { width: 100%; padding: 6px; margin-top: 4px; }

    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 6px; }
    tfoot td { font-weight: bold; }

    .actions { margin-top: 20px; text-align: right; }
    .actions button { padding: 10px 18px; margin-left: 10px; }

    @media print {
        .actions { display: none; }
        body { margin: 0; }
    }
</style>
</head>

<body>

<div class="invoice">

    <img src="logo.png" class="logo">

    <h1>Fatura - Lux Café</h1>

    <label>Número da Fatura</label>
    <input id="numeroFatura">

    <label>Cliente</label>
    <input id="cliente">

    <label>Data de emissão</label>
    <input id="dataEmissao" type="date">

    <label>Data de vencimento</label>
    <input id="dataVencimento" type="date">

    <h3>Itens</h3>
    <table id="itens">
        <thead>
            <tr>
                <th>Descrição</th>
                <th>Qtd</th>
                <th>Valor unitário</th>
                <th>Total</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <td colspan="3">Total geral</td>
                <td id="totalGeral">0,00</td>
                <td></td>
            </tr>
        </tfoot>
    </table>

    <h3>Dados fixos da empresa</h3>
    <p><strong>Luciano Aguiar Santos ME (Lux Café)</strong></p>
    <p>CNPJ: 12.484.624/0001-00</p>
    <p>Rua Oswald de Andrade, nº 9, apt 02 — Vitória da Conquista - BA</p>

    <div class="actions">
        <button onclick="adicionarItem()">Adicionar item</button>
        <button onclick="salvarFatura()">Salvar fatura</button>
        <button onclick="novaFatura()">Nova fatura</button>
        <button onclick="window.print()">Imprimir / PDF</button>
    </div>

</div>

<script>
function formatarMoeda(valor) {
    return valor.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
}

function atualizarTotal() {
    let total = 0;
    document.querySelectorAll('#itens tbody tr').forEach(tr => {
        const qtd = parseFloat(tr.querySelector('.qtd').value) || 0;
        const unit = parseFloat(tr.querySelector('.unit').value) || 0;
        const subtotal = qtd * unit;
        tr.querySelector('.subtotal').textContent = formatarMoeda(subtotal);
        total += subtotal;
    });
    document.getElementById('totalGeral').textContent = formatarMoeda(total);
}

function removerLinha(btn) {
    btn.closest('tr').remove();
    atualizarTotal();
}

function adicionarItem(desc = "", qtd = 1, unit = 0) {
    const tbody = document.querySelector('#itens tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
        <td><input class="desc" value="${desc}"></td>
        <td><input class="qtd" type="number" step="0.01" value="${qtd}"></td>
        <td><input class="unit" type="number" step="0.01" value="${unit}"></td>
        <td class="subtotal">0,00</td>
        <td><button onclick="removerLinha(this)">Remover</button></td>
    `;
    tbody.appendChild(tr);
    tr.querySelectorAll('input').forEach(i => i.addEventListener('input', atualizarTotal));
    atualizarTotal();
}

function salvarFatura() {
    const dados = {
        numero: document.getElementById('numeroFatura').value,
        cliente: document.getElementById('cliente').value,
        emissao: document.getElementById('dataEmissao').value,
        vencimento: document.getElementById('dataVencimento').value,
        itens: []
    };

    document.querySelectorAll('#itens tbody tr').forEach(tr => {
        dados.itens.push({
            desc: tr.querySelector('.desc').value,
            qtd: tr.querySelector('.qtd').value,
            unit: tr.querySelector('.unit').value
        });
    });

    localStorage.setItem("faturaLuxCafe", JSON.stringify(dados));
    alert("Fatura salva com sucesso!");
}

function carregarFatura() {
    const dados = JSON.parse(localStorage.getItem("faturaLuxCafe"));
    if (!dados) return;

    document.getElementById('numeroFatura').value = Number(dados.numero) + 1;
    document.getElementById('cliente').value = dados.cliente;
    document.getElementById('dataEmissao').value = dados.emissao;
    document.getElementById('dataVencimento').value = dados.vencimento;

    document.querySelector('#itens tbody').innerHTML = "";
    dados.itens.forEach(i => adicionarItem(i.desc, i.qtd, i.unit));
}

function novaFatura() {
    document.getElementById('cliente').value = "";
    document.querySelector('#itens tbody').innerHTML = "";
    adicionarItem();
}

window.onload = carregarFatura;
</script>

</body>
</html>

